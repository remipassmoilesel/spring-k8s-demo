version: '3'

# TODO: add container and volume for spring-boot application and sources
# ... or use minikube ?

services:
  mongodb:
    image: mvertes/alpine-mongo:3.6.4-2
    restart: always
    ports:
     - 27017:27017
    networks:
      spring-k8s-demo-dev-network:
        aliases:
        - mongodb.docker.net

  nats:
    image: nats:1.1.0-linux
    entrypoint: "/gnatsd -m 8222 -D"
    restart: always
    ports:
      - 8222:8222
      - 4222:4222
    networks:
      spring-k8s-demo-dev-network:
        aliases:
        - nats.docker.net

  gateway:
    build: ./springboot-dev-image
    image: springboot-dev-image:0.1
    restart: always
    entrypoint: "/sources/docker-compose-dev/entrypoints/gateway.sh"
    volumes:
      - "..:/sources"
    ports:
      - 8080:8080
      - 10100:35729
    networks:
      spring-k8s-demo-dev-network:
        aliases:
        - gateway.docker.net

  signature-service:
    build: ./springboot-dev-image
    image: springboot-dev-image:0.1
    restart: always
    entrypoint: "/sources/docker-compose-dev/entrypoints/signature-service.sh"
    volumes:
      - "..:/sources"
    ports:
      - 8085:8080
      - 10105:35729
    networks:
      spring-k8s-demo-dev-network:
        aliases:
        - signature-service.docker.net

networks:
  spring-k8s-demo-dev-network: